<html>
	<head>
		<title>j.nome.s</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>j.nome.s</h1><h3>What is j.nome.s</h3>

<p>j.nome.s is a fast, simple, lightweight genome browser.
It is built on top of <a href="http://expressjs.com/">expressjs</a> and <a href="http://nodejs.org/">Node.JS</a>,
and uses <a href="http://www.mongodb.org/">MongoDB</a> for storing the data.</p>

<h3>Why j.nome.s</h3>

<p>Current genome browsers include <a href="http://www.gbrowse.org/index.html">GBrowse</a>, the <a href="http://genome.ucsc.edu/">UCSC genome browser</a>
or <a href="http://jbrowse.org/">Jbrowse</a>. The main problem with those project, is that they
heavily rely on <a href="http://www.perl.org/">perl</a> and <a href="http://www.bioperl.org/">BioPerl</a> scripts in order to both crunch data
and render the output.
Although <a href="http://www.perl.org/">perl</a> is widely used by bioinformaticians, it is a very inelegant
language, very often leading to bloatware.
Representing genomes is not an easy task considering the huge amout of data
that has to be handled and shown in an intelligible way.</p>

<p>j.nome.s aims to provide a simple genome browser environment, convenient to
both the user, and the developer.
It is based on <a href="http://nodejs.org/">Node.JS</a>, which allowed to build a custom non
IO-blocking server application. The data is stored in a 
<a href="http://www.mongodb.org/">MongoDB</a> database, providing a scallable and
efficient way to respectively store and access huge amount of data.</p>

<h3>Who</h3>

<p>j.nome.s is an ongoing project initiated by Alexis GRIMALDI and supervised by Avetis KAZARIAN.</p>

<h3>Change log</h3>

<h4>v0.4.8 : 2011-07-22</h4>

<ul><li>Fixed bug in profiles if Y values = 0.</li></ul>

<h4>v0.4.7 : 2011-07-19</h4>

<ul><li>Improved profile caching mechanism to play well with huge references (&gt; 10M).</li><li>Better looking selection rectangle.</li></ul>

<h4>v0.4.6 : 2011-07-18</h4>

<ul><li>Corrected typos.</li><li>Fixed bug causing the app to crash if an empty array is passed to processProfile().</li></ul>

<h4>v0.4.5 : 2011-07-17</h4>

<ul><li>Fixed bug when submitting parameters via the form from a blank page.</li><li>Fixed bug in seqid metadata fetching when switching dataset.</li></ul>

<h4>v0.4.4 : 2011-07-17</h4>

<ul><li>Fixed bug in loadFastaRef.py</li></ul>

<h4>v0.4.3 : 2011-07-17</h4>

<ul><li>Improved profile handling performance by caching data.</li></ul>

<h4>v0.4.2 : 2011-07-17</h4>

<ul><li>Fixed bug in profile rendering for views less than 2kb.</li></ul>

<h4>v0.4.1 : 2011-07-15</h4>

<ul><li>Fixed bug in navigation and tracks alignment.</li></ul>

<h4>v0.4.0 : 2011-07-13</h4>

<ul><li>Fixed bug in the lazy track refresh if position 0 was part of the view.</li><li>Improved history navigation.</li><li>Improved form validation.</li><li>Switched to <a href="https://github.com/marcello3d/node-mongolian">node-mongolian</a> (from mongoose) for performance reasons.</li><li>Implemented profile tracks visualisation.</li></ul>

<h4>v0.3.2 : 2011-06-20</h4>

<ul><li>Fixed visual bug in track reordering.</li><li>Better centering of output-gui.</li></ul>

<h4>v0.3.1 : 2011-06-20</h4>

<ul><li>Lazier track and navigation refresh.</li><li>Documents in a track are ordered.</li></ul>

<h4>v0.3.0 : 2011-06-18</h4>

<ul><li>Possibility to reorder tracks by drag &amp; drop.</li><li>The order of tracks is remembered.</li><li>query and render only new selected tracks is view does not change.</li><li>Favicon redesigned.</li><li>Display overlapping elements of a track on different Y-axis.</li></ul>

<h4>v0.2.0 : 2011-06-14</h4>

<ul><li>Fixed selection going beyond boundaries.</li><li>Fixed non-existing SEQID.</li><li>Fixed SEQID position overflow.</li><li>Use ID instead of name in track rendering.</li><li>Display the track name in the SVG canvas.</li><li>Use configuration files for styles.</li><li>Handle 500 and 404 errors.</li><li>Link to generated API documentation.</li><li>Wrote 'about' section.</li><li>Wrote 'documentation' section.</li><li>Wrote package.json to keep track of dependencies.</li></ul>

<h4>v0.1 : 2011-06-11</h4>

<ul><li>Navigation via rulers.</li></ul></td><td></td></tr><tr class="filename"><td><h2 id="./app.js"><a href="#">app</a></h2></td><td>./app.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">express</span> = <span class="variable">require</span>(<span class="string">'express'</span>);
<span class="keyword">var</span> <span class="variable">stylus</span> = <span class="variable">require</span>(<span class="string">'stylus'</span>);
<span class="keyword">var</span> <span class="variable">nib</span> = <span class="variable">require</span>(<span class="string">'nib'</span>);
<span class="keyword">var</span> <span class="class">Config</span> = <span class="variable">require</span>(<span class="string">'./lib/config'</span>).<span class="class">Config</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Create the main app
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">app</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="variable">express</span>.<span class="variable">createServer</span>();
<span class="keyword">var</span> <span class="variable">config</span> = <span class="keyword">new</span> <span class="class">Config</span>(<span class="variable">app</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Configuration of the express app
 </p>
</td>
<td class="code">
<pre><code><span class="variable">config</span>.<span class="variable">loadDir</span>();

<span class="variable">app</span>.<span class="variable">configure</span>(<span class="keyword">function</span>() {
  <span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'views'</span>, <span class="variable">__dirname</span> + <span class="string">'/views'</span>);
  <span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'view engine'</span>, <span class="string">'jade'</span>);
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">express</span>.<span class="variable">bodyParser</span>());
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">express</span>.<span class="variable">methodOverride</span>());
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">express</span>.<span class="variable">cookieParser</span>());
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">express</span>.<span class="variable">session</span>({ <span class="variable">secret</span>: <span class="string">'topsecret'</span> }));
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">stylus</span>.<span class="variable">middleware</span>({
    <span class="variable">src</span>: <span class="variable">__dirname</span> + <span class="string">'/public'</span>
  , <span class="variable">compile</span>: <span class="keyword">function</span>(<span class="variable">str</span>, <span class="variable">path</span>){
      <span class="keyword">return</span> <span class="variable">stylus</span>(<span class="variable">str</span>)
        .<span class="variable">set</span>(<span class="string">'filename'</span>, <span class="variable">path</span>)
        .<span class="variable">set</span>(<span class="string">'compress'</span>, <span class="variable">true</span>)
        .<span class="variable">use</span>(<span class="variable">nib</span>());
    }
  }));
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">app</span>.<span class="variable">router</span>);
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">express</span>.<span class="variable">static</span>(<span class="variable">__dirname</span> + <span class="string">'/public'</span>));
});

<span class="variable">app</span>.<span class="variable">configure</span>(<span class="string">'development'</span>, <span class="keyword">function</span>() {
  <span class="variable">require</span>(<span class="string">'express-trace'</span>)(<span class="variable">app</span>);
  <span class="variable">app</span>.<span class="variable">use</span>(<span class="variable">express</span>.<span class="variable">errorHandler</span>({ <span class="variable">dumpExceptions</span>: <span class="variable">true</span>, <span class="variable">showStack</span>: <span class="variable">true</span> })); 
  <span class="variable">console</span>.<span class="variable">log</span>(<span class="string">'Application started in development mode.'</span>);
});

<span class="variable">app</span>.<span class="variable">configure</span>(<span class="string">'test'</span>, <span class="keyword">function</span>() {
  <span class="variable">console</span>.<span class="variable">log</span>(<span class="string">'Application started in test mode.'</span>);
});

<span class="variable">app</span>.<span class="variable">configure</span>(<span class="string">'production'</span>, <span class="keyword">function</span>() {
  <span class="variable">console</span>.<span class="variable">log</span>(<span class="string">'Application started in production mode.'</span>);
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Map routes to app functions
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">home</span> = <span class="variable">require</span>(<span class="string">'./controllers/home'</span>);
<span class="keyword">var</span> <span class="variable">doc</span> = <span class="variable">require</span>(<span class="string">'./controllers/doc'</span>);
<span class="keyword">var</span> <span class="variable">api</span> = <span class="variable">require</span>(<span class="string">'./controllers/api'</span>);
<span class="keyword">var</span> <span class="variable">about</span> = <span class="variable">require</span>(<span class="string">'./controllers/about'</span>);
<span class="keyword">var</span> <span class="variable">browse</span> = <span class="variable">require</span>(<span class="string">'./controllers/browse'</span>);

<span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/globalconfig.json'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
  <span class="variable">res</span>.<span class="variable">send</span>(<span class="variable">app</span>.<span class="variable">_locals</span>.<span class="variable">config</span>.<span class="variable">global</span>.<span class="variable">style</span>);
});

<span class="variable">home</span>.<span class="variable">route</span>(<span class="variable">app</span>);
<span class="variable">api</span>.<span class="variable">route</span>(<span class="variable">app</span>);
<span class="variable">doc</span>.<span class="variable">route</span>(<span class="variable">app</span>);
<span class="variable">about</span>.<span class="variable">route</span>(<span class="variable">app</span>);
<span class="variable">browse</span>.<span class="variable">route</span>(<span class="variable">app</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Error handling
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">errors</span> = <span class="variable">require</span>(<span class="string">'./controllers/errors'</span>);

<span class="variable">errors</span>.<span class="variable">route</span>(<span class="variable">app</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Start the express app
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">if</span> (!<span class="variable">module</span>.<span class="variable">parent</span>) {
  <span class="variable">app</span>.<span class="variable">listen</span>(<span class="number integer">3000</span>);
  <span class="variable">console</span>.<span class="variable">log</span>(&<span class="variable">quot</span>;<span class="variable">j</span>.<span class="variable">nome</span>.<span class="variable">s</span> <span class="variable">listening</span> <span class="variable">on</span> <span class="variable">port</span> %<span class="variable">d</span>&<span class="variable">quot</span>;, <span class="variable">app</span>.<span class="variable">address</span>().<span class="variable">port</span>);
}
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./controllers/about.js"><a href="#">about</a></h2></td><td>./controllers/about.js</td></tr><tr class="code">
<td class="docs">
<p>Function used to handle the routing associated to
the 'about' page.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Application</em>  express app</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">route</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to base 'about' page</p>

<h2></h2>

<ul><li><p><strong>handles</strong>: <em>Route</em>  /about</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/about'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'about'</span>, {
      <span class="variable">title</span>: <span class="string">'About'</span>
    });
  });

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">route</span> = <span class="variable">route</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./controllers/api.js"><a href="#">api</a></h2></td><td>./controllers/api.js</td></tr><tr class="code">
<td class="docs">
<p>Function used to handle the routing associated to
the API page.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  application</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">route</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to base API page</p>

<h2></h2>

<ul><li><p><strong>handle</strong>: <em>Route#GET</em>  /api</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/api'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="variable">res</span>.<span class="variable">sendfile</span>(<span class="string">'./docs/api.html'</span>);
  });

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">route</span> = <span class="variable">route</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./controllers/browse.js"><a href="#">browse</a></h2></td><td>./controllers/browse.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">dbutils</span> = <span class="variable">require</span>(<span class="string">'../lib/dbutils'</span>);
<span class="keyword">var</span> <span class="class">Reference</span> = <span class="variable">require</span>(<span class="string">'../models/reference'</span>).<span class="class">Reference</span>;
<span class="keyword">var</span> <span class="class">Track</span> = <span class="variable">require</span>(<span class="string">'../models/track'</span>).<span class="class">Track</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Function used to handle the routing associated to
the dataset controller.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  application</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">route</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to a specific dataset</p>

<p>Handling this route triggers the dbutils.connect middleware
in order to connect to the mongo database.
The browse/index.jade view is rendered in case of success.</p>

<ul><li><p><strong>see</strong>: <em>dbutils</em>
.connect
## </p></li><li><p><strong>handles</strong>: <em>Route#GET</em>  /browse/:dataset</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/browse/:dataset'</span>, <span class="variable">dbutils</span>.<span class="variable">connect</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>, <span class="variable">next</span>) {
    <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'browse'</span>, {
      <span class="variable">title</span>: <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">dataset</span>
    , <span class="variable">dataset</span>: <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">dataset</span>
    , <span class="variable">seqid</span>: <span class="string">'seqid'</span>
    , <span class="variable">start</span>: <span class="string">'start'</span>
    , <span class="variable">end</span>: <span class="string">'end'</span>
    , <span class="variable">checked</span>: {}
    , <span class="variable">data</span>: <span class="string">''</span>
    });
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Respond to AJAX track requests.</p>

<p>Handling this route triggers the dbutils.connect middleware
in order to connect to the mongo database.
The track data is sent to the AJAX request event.</p>

<ul><li><p><strong>see</strong>: <em>dbutils</em>
.connect
## </p></li><li><p><strong>handles</strong>: <em>Route#POST</em>  /browse/:dataset</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">post</span>(<span class="string">'/browse/:dataset'</span>, <span class="variable">dbutils</span>.<span class="variable">connect</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="keyword">var</span> <span class="variable">track</span> = <span class="keyword">new</span> <span class="class">Track</span>(<span class="variable">req</span>.<span class="variable">dataset</span>, <span class="variable">app</span>.<span class="variable">_locals</span>.<span class="variable">config</span>[<span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">dataset</span>].<span class="variable">tracks</span>[<span class="variable">req</span>.<span class="variable">body</span>.<span class="variable">trackID</span>]);
    <span class="variable">track</span>.<span class="variable">fetchInInterval</span>(
      <span class="variable">req</span>.<span class="variable">body</span>.<span class="variable">seqid</span>
    , <span class="variable">req</span>.<span class="variable">body</span>.<span class="variable">start</span>
    , <span class="variable">req</span>.<span class="variable">body</span>.<span class="variable">end</span>
    , <span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">data</span>) {
        <span class="variable">res</span>.<span class="variable">send</span>(<span class="variable">data</span>);
      }
    );
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Fetches the metadata of a specific seqid</p>

<p>Handling this route triggers the dbutils.connect middleware
in order to connect to the mongo database.</p>

<ul><li><p><strong>see</strong>: <em>dbutils</em>
.connect
## </p></li><li><p><strong>handles</strong>: <em>Route#POST</em>  /browse/:dataset/:seqid.json</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/browse/:dataset/:seqid.:format'</span>, <span class="variable">dbutils</span>.<span class="variable">connect</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="keyword">if</span> (<span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">format</span> === <span class="string">'json'</span>) {
      <span class="keyword">var</span> <span class="variable">reference</span> = <span class="keyword">new</span> <span class="class">Reference</span>(<span class="variable">req</span>.<span class="variable">dataset</span>);
      <span class="variable">reference</span>.<span class="variable">getMetadata</span>(<span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">seqid</span>, <span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">metadata</span>) {
        <span class="variable">res</span>.<span class="variable">send</span>(<span class="variable">metadata</span>);
      });
    }
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to a specific range, with specified collections</p>

<p>Handling this route triggers the dbutils.connect middleware
in order to connect to the mongo database.</p>

<ul><li><p><strong>see</strong>: <em>dbutils</em>
.connect
## </p></li><li><p><strong>handles</strong>: <em>Route#GET</em>  /browse/:dataset/:seqid/:start/:end/:tracks</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/browse/:dataset/:seqid/:start/:end/:tracks'</span>, <span class="variable">dbutils</span>.<span class="variable">connect</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="keyword">var</span> <span class="variable">checked</span> = {};
    <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">tracks</span>.<span class="variable">split</span>(<span class="string">'&amp;'</span>).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">track</span>) {
      <span class="variable">checked</span>[<span class="variable">track</span>] = <span class="variable">true</span>;
    });
    <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'browse'</span>, {
      <span class="variable">title</span>: <span class="string">'j.nome.s : browse'</span>
    , <span class="variable">dataset</span>: <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">dataset</span>
    , <span class="variable">seqid</span>: <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">seqid</span>
    , <span class="variable">start</span>: <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">start</span>
    , <span class="variable">end</span>: <span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">end</span>
    , <span class="variable">checked</span>: <span class="variable">checked</span>
    });
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Redirect to base url of dataset if parameters are incomplete</p>

<p>Handling this route triggers the dbutils.connect middleware
in order to connect to the mongo database.</p>

<ul><li><p><strong>see</strong>: <em>dbutils</em>
.connect
## </p></li><li><p><strong>handles</strong>: <em>Route#GET</em>  /browse/:dataset/*</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>('<span class="regexp">/browse/</span>:<span class="variable">dataset</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>', dbutils.connect, function(req, res) {
    res.redirect('/browse/' + req.params.dataset);
  });</p>

<p>};</p>

<p>/**
Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">route</span> = <span class="variable">route</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./controllers/doc.js"><a href="#">doc</a></h2></td><td>./controllers/doc.js</td></tr><tr class="code">
<td class="docs">
<p>Function used to handle the routing associated to
the documentation page.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  application</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">route</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to base 'doc' page.</p>

<h2></h2>

<ul><li><p><strong>handle</strong>: <em>Route#GET</em>  /doc</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/doc'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'doc'</span>, {
      <span class="variable">title</span>: <span class="string">'Documentation'</span>
    });
  });

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">route</span> = <span class="variable">route</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./controllers/errors.js"><a href="#">errors</a></h2></td><td>./controllers/errors.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">util</span> = <span class="variable">require</span>(<span class="string">'util'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>NotFound error</p>

<p>Inherits from Error
This is used in case of 404 errors.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  message</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">NotFound</span> = <span class="keyword">function</span>(<span class="variable">message</span>) {
  <span class="this">this</span>.<span class="variable">name</span> = <span class="string">'NotFound'</span>;
  <span class="this">this</span>.<span class="variable">message</span> = (<span class="variable">message</span>) ? <span class="variable">message</span> : &<span class="variable">quot</span>;<span class="class">Not</span> <span class="class">Found</span>&<span class="variable">quot</span>;;
  <span class="class">Error</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">message</span>);
  <span class="class">Error</span>.<span class="variable">captureStackTrace</span>(<span class="this">this</span>, <span class="variable">arguments</span>.<span class="variable">callee</span>);
}
<span class="variable">util</span>.<span class="variable">inherits</span>(<span class="class">NotFound</span>, <span class="class">Error</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Function used to handle the routing associated to
the error controller</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  application</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">route</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle 404 errors.</p>

<p>If the error is not a 404 error, the callback is triggered
so that the next matching handler can handle it.
Otherwise, renders the 404 view.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">error</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">req</span>, <span class="variable">res</span>, <span class="variable">next</span>) {
    <span class="keyword">if</span> (<span class="variable">err</span> <span class="variable">instanceof</span> <span class="class">NotFound</span>) {
      <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'404.jade'</span>, {
        <span class="variable">title</span>: <span class="string">'Not Found'</span>
      , <span class="variable">status</span>: <span class="number integer">404</span>
      , <span class="variable">locals</span>: { <span class="variable">error</span>: <span class="variable">err</span> }
      });
    } <span class="keyword">else</span> {
      <span class="variable">next</span>(<span class="variable">err</span>);
    }
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle 500 errors.</p>

<p>Since this is the final exception handler,
not callback is necessary.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">error</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'500.jade'</span>, {
      <span class="variable">title</span>: <span class="string">'Server Error'</span>
    , <span class="variable">status</span>: <span class="number integer">500</span>
    , <span class="variable">locals</span>: { <span class="variable">error</span>: <span class="variable">err</span> }
    });
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to 404 error</p>

<h2></h2>

<ul><li><p><strong>handle</strong>: <em>Route#GET</em>  /404</p></li><li><p><strong>throws</strong>: <em>NotFound</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/404'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">NotFound</span>;
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to 500 error</p>

<h2></h2>

<ul><li><p><strong>handle</strong>: <em>Route#GET</em>  /500</p></li><li><p><strong>throws</strong>: <em>Error</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/500'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'Server Side Error.'</span>);
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle any non registered URL by throwing a 404 exception.</p>

<h2></h2>

<ul><li><p><strong>throws</strong>: <em>NotFound</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">use</span>(<span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">NotFound</span>(<span class="string">'404 - Page not found.'</span>);
  });

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">route</span> = <span class="variable">route</span>;
<span class="variable">exports</span>.<span class="class">NotFound</span> = <span class="class">NotFound</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./controllers/home.js"><a href="#">home</a></h2></td><td>./controllers/home.js</td></tr><tr class="code">
<td class="docs">
<p>Function used to handle the routing associated to
the homepage '/'</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  application</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">route</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Route to homepage</p>

<h2></h2>

<ul><li><p><strong>handle</strong>: <em>Route#GET</em>  /</p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">app</span>.<span class="variable">get</span>(<span class="string">'/'</span>, <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>) {
    <span class="variable">res</span>.<span class="variable">render</span>(<span class="string">'index'</span>, {
      <span class="variable">title</span>: <span class="string">'j.nome.s'</span>
    });
  });

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">route</span> = <span class="variable">route</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./lib/config.js"><a href="#">config</a></h2></td><td>./lib/config.js</td></tr><tr class="code">
<td class="docs">
<p>Modules dependencies
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">fs</span> = <span class="variable">require</span>(<span class="string">'fs'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Class used to manipulate app configuration</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  express app</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Config</span> = <span class="keyword">function</span>(<span class="variable">app</span>) {
  <span class="this">this</span>.<span class="variable">app</span> = <span class="variable">app</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Loads a specified config file</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  file</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Config</span>.<span class="variable">prototype</span>.<span class="variable">loadFile</span> = <span class="keyword">function</span>(<span class="variable">file</span>, <span class="variable">callback</span>) {
  <span class="variable">callback</span>(<span class="class">JSON</span>.<span class="variable">parse</span>(<span class="variable">fs</span>.<span class="variable">readFileSync</span>(<span class="variable">file</span>)));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Loads and processes the global config file</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  file</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Config</span>.<span class="variable">prototype</span>.<span class="variable">loadGlobal</span> = <span class="keyword">function</span>(<span class="variable">file</span>, <span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="keyword">var</span> <span class="variable">root_dir</span> = <span class="variable">file</span>.<span class="variable">split</span>(<span class="string">'/'</span>).<span class="variable">slice</span>(<span class="number integer">0</span>, -<span class="number integer">1</span>).<span class="variable">join</span>(<span class="string">'/'</span>);
  <span class="keyword">var</span> <span class="variable">dataset_file</span> = <span class="string">''</span>;
  <span class="keyword">var</span> <span class="variable">config</span> = {};
  <span class="variable">self</span>.<span class="variable">loadFile</span>(<span class="variable">file</span>, <span class="keyword">function</span>(<span class="variable">config_global</span>) {
    <span class="variable">config</span>[<span class="string">'global'</span>] = <span class="variable">config_global</span>;
    <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">dataset</span> <span class="keyword">in</span> <span class="variable">config_global</span>.<span class="variable">datasets</span>) {
      <span class="variable">dataset_file</span> = [<span class="variable">root_dir</span>, <span class="variable">config_global</span>.<span class="variable">datasets</span>[<span class="variable">dataset</span>].<span class="variable">file</span>].<span class="variable">join</span>(<span class="string">'/'</span>);
      <span class="variable">self</span>.<span class="variable">loadFile</span>(<span class="variable">dataset_file</span>, <span class="keyword">function</span>(<span class="variable">config_dataset</span>) {
        <span class="variable">config</span>[<span class="variable">dataset</span>] = <span class="variable">config_dataset</span>;
      });
    }
    <span class="variable">callback</span>(<span class="variable">config</span>);
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Loads the data contained in the configuration files</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  configuration directory</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Config</span>.<span class="variable">prototype</span>.<span class="variable">loadDir</span> = <span class="keyword">function</span>(<span class="variable">dir</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>
    , <span class="variable">configs_dir</span> = <span class="variable">dir</span> || <span class="variable">process</span>.<span class="variable">cwd</span>() + <span class="string">'/config'</span>
    , <span class="variable">config_global_file</span> = <span class="variable">configs_dir</span> + <span class="string">'/'</span> + <span class="string">'global.json'</span>;
  <span class="variable">self</span>.<span class="variable">loadGlobal</span>(<span class="variable">config_global_file</span>, <span class="keyword">function</span>(<span class="variable">config</span>) {
    <span class="variable">self</span>.<span class="variable">app</span>.<span class="variable">locals</span>({ <span class="variable">config</span>: <span class="variable">config</span> });
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="class">Config</span> = <span class="class">Config</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./lib/dbutils.js"><a href="#">dbutils</a></h2></td><td>./lib/dbutils.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Mongolian</span> = <span class="variable">require</span>(<span class="string">'mongolian'</span>);
<span class="keyword">var</span> <span class="class">NotFound</span> = <span class="variable">require</span>(<span class="string">'../controllers/errors'</span>).<span class="class">NotFound</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Middleware used to connect to a specific database</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  request</p></li><li><p><strong>param</strong>: <em>Object</em>  response</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">connect</span> = <span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>, <span class="variable">next</span>) {
  <span class="keyword">var</span> <span class="variable">server</span> = <span class="keyword">new</span> <span class="class">Mongolian</span>;
  <span class="keyword">if</span> (!<span class="variable">req</span>.<span class="variable">app</span>.<span class="variable">_locals</span>.<span class="variable">config</span>[<span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">dataset</span>]) {
    <span class="keyword">return</span> <span class="variable">next</span>(<span class="keyword">new</span> <span class="class">NotFound</span>(&<span class="variable">quot</span>;<span class="variable">dataset</span> <span class="string">'&quot; + req.params.dataset + &quot;'</span> <span class="variable">does</span> <span class="variable">not</span> <span class="variable">exist</span>.&<span class="variable">quot</span>;));
  } <span class="keyword">else</span> {
    <span class="variable">req</span>.<span class="variable">dataset</span> = <span class="variable">server</span>.<span class="variable">db</span>(<span class="variable">req</span>.<span class="variable">params</span>.<span class="variable">dataset</span>);
    <span class="variable">next</span>();
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">connect</span> = <span class="variable">connect</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./models/reference.js"><a href="#">reference</a></h2></td><td>./models/reference.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Mongolian</span> = <span class="variable">require</span>(<span class="string">'mongolian'</span>)
  , <span class="class">NotFound</span> = <span class="variable">require</span>(<span class="string">'../controllers/errors'</span>).<span class="class">NotFound</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Class to easily access the reference genome stored in a GrifFS</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Reference</span> = <span class="keyword">function</span>(<span class="variable">db</span>){
  <span class="this">this</span>.<span class="variable">gridfs</span> = <span class="variable">db</span>.<span class="variable">gridfs</span>();
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Gets the metadata of seqid stored in the gridfs.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  seqid</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Reference</span>.<span class="variable">prototype</span>.<span class="variable">getMetadata</span> = <span class="keyword">function</span>(<span class="variable">seqid</span>, <span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">gridfs</span>.<span class="variable">findOne</span>(<span class="variable">seqid</span>, <span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">doc</span>) {
    <span class="keyword">if</span> (<span class="variable">doc</span>) {
      <span class="variable">callback</span>(<span class="variable">err</span>, {
        <span class="variable">_id</span>: <span class="variable">doc</span>.<span class="variable">_id</span>
      , <span class="variable">length</span>: <span class="variable">doc</span>.<span class="variable">length</span>
      , <span class="variable">chunkSize</span>: <span class="variable">doc</span>.<span class="variable">chunkSize</span>
      , <span class="variable">md5</span>: <span class="variable">doc</span>.<span class="variable">md5</span>
      , <span class="variable">filename</span>: <span class="variable">doc</span>.<span class="variable">filename</span>
      , <span class="variable">contentType</span>: <span class="variable">doc</span>.<span class="variable">contentType</span>
      , <span class="variable">uploadDate</span>: <span class="variable">doc</span>.<span class="variable">uploadDate</span>
      });
    } <span class="keyword">else</span> {
      <span class="variable">callback</span>(<span class="variable">err</span>, <span class="keyword">null</span>);
    }
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get the sequence corresponding to the given seqid</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  id</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="comment">//Reference.prototype.findById = function(id, callback){</span>
  <span class="comment">//var self = this</span>
    <span class="comment">//, data = '';</span>
  <span class="comment">//self.files.findById(id, function(err, file){</span>
    <span class="comment">//if (file){</span>
      <span class="comment">//self.chunks.find({files_id: id}, [], function(err, chunks){</span>
        <span class="comment">//chunks.forEach(function(chunk){</span>
          <span class="comment">//data += chunk.data;</span>
        <span class="comment">//});</span>
        <span class="comment">//callback(err, {</span>
          <span class="comment">//_id: file['_id']</span>
        <span class="comment">//, length: file['length']</span>
        <span class="comment">//, md5: file['md5']</span>
        <span class="comment">//, data: data</span>
        <span class="comment">//});</span>
      <span class="comment">//});</span>
    <span class="comment">//} else {</span>
      <span class="comment">//callback(err, {});</span>
    <span class="comment">//}</span>
  <span class="comment">//});</span>
<span class="comment">//};</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="class">Reference</span> = <span class="class">Reference</span>
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./models/track.js"><a href="#">track</a></h2></td><td>./models/track.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Mongolian</span> = <span class="variable">require</span>(<span class="string">'mongolian'</span>)
<span class="keyword">var</span> <span class="variable">processProfile</span> = <span class="variable">require</span>(<span class="string">'../lib/cutils'</span>).<span class="variable">processProfile</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Compute step according to the length of the selected region</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  span</p></li><li><p><strong>return</strong>: <em>Number</em>  step</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">getStep</span> = <span class="keyword">function</span>(<span class="variable">span</span>) {
  <span class="keyword">if</span> (<span class="variable">span</span> &<span class="variable">lt</span>;= <span class="number integer">1000000</span>) {
    <span class="keyword">return</span> ~~(<span class="variable">span</span>/<span class="number integer">10000</span>) + <span class="number integer">1</span>;
  }
  <span class="keyword">return</span> <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>, (~~(<span class="class">Math</span>.<span class="variable">log</span>(<span class="variable">span</span>)/<span class="class">Math</span>.<span class="variable">log</span>(<span class="number integer">10</span>)) - <span class="number integer">4</span>)) * <span class="number integer">5</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inserts a processed profile in the database.
Fetching from this cached profile is faster than
processing the processed profile each time.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>MongolianCollection</em>  collection</p></li><li><p><strong>param</strong>: <em>String</em>  seqid</p></li><li><p><strong>param</strong>: <em>Number</em>  step</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">cacheProfile</span> = <span class="keyword">function</span>(<span class="variable">collection</span>, <span class="variable">seqid</span>, <span class="variable">step</span>, <span class="variable">callback</span>) {
  <span class="variable">collection</span>.<span class="variable">find</span>({ <span class="variable">seqid</span>: <span class="variable">seqid</span> }).<span class="variable">toArray</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">docs</span>) {
    <span class="variable">pdocs</span> = <span class="variable">processProfile</span>(<span class="variable">docs</span>, <span class="variable">step</span>);
    <span class="variable">pdocs</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">doc</span>) {
      <span class="variable">doc</span>.<span class="variable">step</span> = <span class="variable">step</span>;
      <span class="variable">collection</span>.<span class="variable">insert</span>(<span class="variable">doc</span>, <span class="keyword">function</span>(){});
    });
    <span class="variable">callback</span>();
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Function invoked to query a profile track (collection).
This function takes care of querying the cached profile if
it exists, or to compute it and cache it if it doesn't.
If the step used in the profile processing is &lt; 500,
the profile is processed on the fly.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>MongolianCollection</em>  col</p></li><li><p><strong>param</strong>: <em>String</em>  seqid</p></li><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Number</em>  step</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">queryProfile</span> = <span class="keyword">function</span>(<span class="variable">collection</span>, <span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">step</span>, <span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">query</span> = {
    <span class="variable">seqid</span>: <span class="variable">seqid</span>
  , <span class="variable">start</span>: { $<span class="variable">lt</span>: <span class="variable">end</span> }
  , <span class="variable">end</span>: { $<span class="variable">gt</span>: <span class="variable">start</span> }
  , <span class="variable">step</span>: { $<span class="variable">exists</span>: <span class="variable">false</span> }
  };
  <span class="keyword">var</span> <span class="variable">sortOrder</span> = {
    <span class="variable">seqid</span>: <span class="number integer">1</span>
  , <span class="variable">start</span>: <span class="number integer">1</span>
  , <span class="variable">end</span>: <span class="number integer">1</span>
  };
  <span class="keyword">if</span> (<span class="variable">step</span> % <span class="number integer">500</span> === <span class="number integer">0</span>) {
    <span class="keyword">var</span> <span class="variable">queryCache</span> = <span class="variable">query</span>;
    <span class="variable">queryCache</span>.<span class="variable">step</span> = <span class="variable">step</span>;
    <span class="variable">collection</span>.<span class="variable">find</span>(<span class="variable">queryCache</span>).<span class="variable">sort</span>(<span class="variable">sortOrder</span>).<span class="variable">toArray</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">cachedDocs</span>) {
      <span class="keyword">if</span> (<span class="variable">cachedDocs</span>.<span class="variable">length</span> === <span class="number integer">0</span>) {
        <span class="variable">cacheProfile</span>(<span class="variable">collection</span>, <span class="variable">seqid</span>, <span class="variable">step</span>, <span class="keyword">function</span>() {
          <span class="variable">collection</span>.<span class="variable">find</span>(<span class="variable">queryCache</span>).<span class="variable">sort</span>(<span class="variable">sortOrder</span>).<span class="variable">toArray</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">cachedDocs</span>) {
            <span class="variable">callback</span>(<span class="variable">err</span>, <span class="variable">cachedDocs</span>);
          });
        });
      } <span class="keyword">else</span> {
        <span class="variable">callback</span>(<span class="variable">err</span>, <span class="variable">cachedDocs</span>);
      }
    });
  } <span class="keyword">else</span> {
    <span class="variable">collection</span>.<span class="variable">find</span>(<span class="variable">query</span>).<span class="variable">sort</span>(<span class="variable">sortOrder</span>).<span class="variable">toArray</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">docs</span>) {
      <span class="variable">callback</span>(<span class="variable">err</span>, <span class="variable">processProfile</span>(<span class="variable">docs</span>, <span class="variable">step</span>));
    });
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Function invoked to query a reference track.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>MongolianCollection</em>  collection</p></li><li><p><strong>param</strong>: <em>String</em>  seqid</p></li><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Number</em>  step</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">queryRef</span> = <span class="keyword">function</span>(<span class="variable">collection</span>, <span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">step</span>, <span class="variable">callback</span>) {
  <span class="variable">collection</span>.<span class="variable">find</span>({
    <span class="variable">seqid</span>: <span class="variable">seqid</span>
  , <span class="variable">start</span>: { $<span class="variable">lt</span>: <span class="variable">end</span> }
  , <span class="variable">end</span>: { $<span class="variable">gt</span>: <span class="variable">start</span> }
  }).<span class="variable">toArray</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">docs</span>) {
    <span class="variable">callback</span>(<span class="variable">err</span>, <span class="variable">docs</span>);
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Class representing a track.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>String</em>  collection</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Track</span> = <span class="keyword">function</span>(<span class="variable">db</span>, <span class="variable">metadata</span>) {
  <span class="this">this</span>.<span class="variable">metadata</span> = <span class="variable">metadata</span>;
  <span class="this">this</span>.<span class="variable">db</span> = <span class="variable">db</span>;
  <span class="this">this</span>.<span class="variable">collection</span> = <span class="this">this</span>.<span class="variable">db</span>.<span class="variable">collection</span>(<span class="variable">metadata</span>.<span class="variable">id</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Fetch all documents on seqid between 2 positions</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  seqid</p></li><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">fetchInInterval</span> = <span class="keyword">function</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="keyword">var</span> <span class="variable">start</span> = ~~<span class="variable">start</span>;
  <span class="keyword">var</span> <span class="variable">end</span> = ~~<span class="variable">end</span>;
  <span class="keyword">var</span> <span class="variable">step</span> = <span class="variable">getStep</span>(<span class="variable">end</span> - <span class="variable">start</span>);
  <span class="keyword">var</span> <span class="variable">query</span> = <span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">type</span> === <span class="string">'profile'</span> ? <span class="variable">queryProfile</span> : <span class="variable">queryRef</span>;
  <span class="variable">query</span>(<span class="variable">self</span>.<span class="variable">collection</span>, <span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">step</span>, <span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">docs</span>) {
    <span class="variable">callback</span>(<span class="variable">err</span>, {
      <span class="variable">metadata</span>: <span class="variable">self</span>.<span class="variable">metadata</span>
    , <span class="variable">data</span>: <span class="variable">docs</span>
    });
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose public functions, classes and methods
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="class">Track</span> = <span class="class">Track</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./public/javascripts/tracks.js"><a href="#">tracks</a></h2></td><td>./public/javascripts/tracks.js</td></tr><tr class="code">
<td class="docs">
<p>Class for handling track display</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  track</p></li><li><p><strong>param</strong>: <em>Number</em>  width</p></li><li><p><strong>param</strong>: <em>Number</em>  height</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Track</span> = <span class="keyword">function</span>(<span class="variable">track</span>, <span class="variable">width</span>, <span class="variable">height</span>) {
  <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">width</span>;
  <span class="this">this</span>.<span class="variable">height</span> = <span class="variable">height</span>;
  <span class="this">this</span>.<span class="variable">metadata</span> = <span class="variable">track</span>.<span class="variable">metadata</span>;
  <span class="this">this</span>.<span class="variable">data</span> = <span class="variable">track</span>.<span class="variable">data</span>;
  <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">background</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">bgrules</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">documents</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">title</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">div</span> = $(<span class="variable">track</span>\<span class="string">' id=track'</span>+ <span class="this">this</span>.<span class="variable">metadata</span>.<span class="variable">id</span> +<span class="string">'&gt;&lt;/div&gt;'</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display a track.
Instanciates and creates the containing elements if they don't exist.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">display</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="keyword">if</span> ($(<span class="string">'#track'</span>+<span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">id</span>).<span class="variable">length</span> === <span class="number integer">0</span>){
    $(<span class="string">'#tracks'</span>).<span class="variable">append</span>(<span class="variable">self</span>.<span class="variable">div</span>);
  }
  <span class="variable">self</span>.<span class="variable">canvas</span> = <span class="class">Raphael</span>(<span class="string">'track'</span>+<span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">id</span>, <span class="variable">self</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">height</span>);
  <span class="variable">self</span>.<span class="variable">background</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">rect</span>(<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">height</span>).<span class="variable">attr</span>({
    <span class="variable">fill</span>: <span class="string">'#fff'</span>
  , <span class="variable">stroke</span>: <span class="string">'#fff'</span>
  });
  <span class="variable">self</span>.<span class="variable">bgrules</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawBgRules</span>(<span class="number integer">10</span>, { <span class="variable">stroke</span>: <span class="string">'#eee'</span> });
  <span class="variable">self</span>.<span class="variable">title</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">text</span>(<span class="number integer">3</span>, <span class="number integer">5</span>, <span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">name</span>).<span class="variable">attr</span>({
    <span class="string">'font-size'</span>: <span class="number integer">14</span>
  , <span class="string">'font-weight'</span>: <span class="string">'bold'</span>
  , <span class="string">'text-anchor'</span>: <span class="string">'start'</span>
  });
  <span class="variable">self</span>.<span class="variable">documents</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">set</span>();
  <span class="variable">self</span>.<span class="variable">orderLayers</span>();
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">start</span>, <span class="variable">end</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the track's data according to it's type</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>see</strong>: <em>drawDocuments</em>
()</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">draw</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="keyword">if</span> (<span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">type</span> === <span class="string">'ref'</span>) {
    <span class="variable">self</span>.<span class="variable">drawDocuments</span>(<span class="variable">start</span>, <span class="variable">end</span>);
  }
  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">type</span> === <span class="string">'profile'</span>) {
    <span class="variable">self</span>.<span class="variable">drawProfile</span>(<span class="variable">start</span>, <span class="variable">end</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the documents in the track canvas</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>see</strong>: <em>drawDocument</em>
()</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">drawDocuments</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="keyword">var</span> <span class="variable">layers</span> = [];
  <span class="keyword">var</span> <span class="variable">laidout</span> = <span class="variable">false</span>;
  <span class="keyword">var</span> <span class="variable">next</span> = <span class="variable">false</span>;
  <span class="keyword">var</span> <span class="variable">start_overlap</span>;
  <span class="keyword">var</span> <span class="variable">end_overlap</span>;
  <span class="variable">self</span>.<span class="variable">data</span>.<span class="variable">sort</span>(<span class="keyword">function</span>(<span class="variable">a</span>, <span class="variable">b</span>) {
    <span class="keyword">return</span> (<span class="variable">b</span>.<span class="variable">end</span> - <span class="variable">b</span>.<span class="variable">start</span>) - (<span class="variable">a</span>.<span class="variable">end</span> - <span class="variable">a</span>.<span class="variable">start</span>);
  });
  <span class="variable">self</span>.<span class="variable">data</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">doc</span>) {
    <span class="variable">laidout</span> = <span class="variable">false</span>;
    <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">layers</span>.<span class="variable">length</span>; ++<span class="variable">i</span>) {
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">j</span> = <span class="number integer">0</span>; <span class="variable">j</span> &<span class="variable">lt</span>; <span class="variable">layers</span>[<span class="variable">i</span>].<span class="variable">length</span>; ++<span class="variable">j</span>) {
        <span class="variable">start_overlap</span> = <span class="variable">doc</span>.<span class="variable">start</span> &<span class="variable">gt</span>;= <span class="variable">layers</span>[<span class="variable">i</span>][<span class="variable">j</span>][<span class="number integer">0</span>] &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">doc</span>.<span class="variable">start</span> &<span class="variable">lt</span>;= <span class="variable">layers</span>[<span class="variable">i</span>][<span class="variable">j</span>][<span class="number integer">1</span>];
        <span class="variable">end_overlap</span> = <span class="variable">doc</span>.<span class="variable">end</span> &<span class="variable">gt</span>;= <span class="variable">layers</span>[<span class="variable">i</span>][<span class="variable">j</span>][<span class="number integer">0</span>] &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">doc</span>.<span class="variable">end</span> &<span class="variable">lt</span>;= <span class="variable">layers</span>[<span class="variable">i</span>][<span class="variable">j</span>][<span class="number integer">1</span>];
        <span class="keyword">if</span> (<span class="variable">start_overlap</span> || <span class="variable">end_overlap</span>) {
          <span class="variable">next</span> = <span class="variable">true</span>;
          <span class="keyword">break</span>;
        }
      }
      <span class="keyword">if</span> (!<span class="variable">next</span>) {
        <span class="variable">self</span>.<span class="variable">documents</span>.<span class="variable">push</span>(<span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawDocument</span>(<span class="variable">doc</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">i</span>, <span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">style</span>));
        <span class="variable">layers</span>[<span class="variable">i</span>].<span class="variable">push</span>([<span class="variable">doc</span>.<span class="variable">start</span>, <span class="variable">doc</span>.<span class="variable">end</span>]);
        <span class="variable">laidout</span> = <span class="variable">true</span>;
        <span class="keyword">break</span>;
      }
      <span class="variable">next</span> = <span class="variable">false</span>;
    }
    <span class="keyword">if</span> (!<span class="variable">laidout</span>) {
      <span class="keyword">if</span> (<span class="variable">layers</span>.<span class="variable">length</span>) {
        <span class="variable">self</span>.<span class="variable">resize</span>(<span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">height</span>+<span class="number integer">20</span>);
      }
      <span class="variable">self</span>.<span class="variable">documents</span>.<span class="variable">push</span>(<span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawDocument</span>(<span class="variable">doc</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">i</span>, <span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">style</span>));
      <span class="variable">layers</span>.<span class="variable">push</span>([[<span class="variable">doc</span>.<span class="variable">start</span>, <span class="variable">doc</span>.<span class="variable">end</span>]]);
    }
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw a profile track</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">drawProfile</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="keyword">var</span> <span class="variable">xvals</span> = [];
  <span class="keyword">var</span> <span class="variable">yvals</span> = [];
  <span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>;
  <span class="keyword">if</span> (<span class="variable">self</span>.<span class="variable">data</span>.<span class="variable">length</span> !== <span class="number integer">0</span>) {
    <span class="variable">self</span>.<span class="variable">data</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">doc</span>) {
      <span class="keyword">for</span> (<span class="variable">i</span> = <span class="variable">doc</span>.<span class="variable">start</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">doc</span>.<span class="variable">end</span>; <span class="variable">i</span>++) {
        <span class="variable">xvals</span>.<span class="variable">push</span>(<span class="variable">i</span>);
        <span class="variable">yvals</span>.<span class="variable">push</span>(<span class="variable">doc</span>.<span class="variable">score</span>);
      }
    });
    <span class="variable">self</span>.<span class="variable">resize</span>(<span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="number integer">170</span>);
    <span class="variable">self</span>.<span class="variable">documents</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">g</span>.<span class="variable">linechart</span>(<span class="number integer">25</span>, <span class="number integer">5</span>, <span class="variable">self</span>.<span class="variable">width</span>-<span class="number integer">50</span>, <span class="number integer">170</span>, <span class="variable">xvals</span>, <span class="variable">yvals</span>, {
      <span class="variable">shade</span>: <span class="variable">true</span>
    , <span class="variable">gutter</span>: <span class="number integer">25</span>
    , <span class="variable">axis</span>: <span class="string">'0 0 0 1'</span>
    }).<span class="variable">hoverColumn</span>(
      <span class="keyword">function</span>(){
        <span class="this">this</span>.<span class="variable">popups</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">set</span>();
        <span class="this">this</span>.<span class="variable">popups</span>.<span class="variable">push</span>(<span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">g</span>.<span class="variable">popup</span>(<span class="this">this</span>.<span class="variable">x</span>, <span class="this">this</span>.<span class="variable">y</span>[<span class="number integer">0</span>], ~~(<span class="this">this</span>.<span class="variable">values</span>[<span class="number integer">0</span>])+<span class="string">''</span>).<span class="variable">insertBefore</span>(<span class="this">this</span>));
      },
      <span class="keyword">function</span>() {
        <span class="this">this</span>.<span class="variable">popups</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="this">this</span>.<span class="variable">popups</span>.<span class="variable">remove</span>();
      }
    );
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the documents in the track canvas</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>see</strong>: <em>drawDocument</em>
()</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">orderLayers</span> = <span class="keyword">function</span>() {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">documents</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">title</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">bgrules</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">background</span>.<span class="variable">toBack</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Resize the track's canvas
 </p>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">resize</span> = <span class="keyword">function</span>(<span class="variable">width</span>, <span class="variable">height</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">background</span>.<span class="variable">remove</span>();
  <span class="variable">self</span>.<span class="variable">bgrules</span>.<span class="variable">remove</span>();
  <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">setSize</span>(<span class="variable">width</span>, <span class="variable">height</span>);
  <span class="variable">self</span>.<span class="variable">background</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">rect</span>(<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">height</span>).<span class="variable">attr</span>({
    <span class="variable">fill</span>: <span class="string">'#fff'</span>
  , <span class="variable">stroke</span>: <span class="string">'#fff'</span>
  });
  <span class="variable">self</span>.<span class="variable">bgrules</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawBgRules</span>(<span class="number integer">10</span>, { <span class="variable">stroke</span>: <span class="string">'#eee'</span> });
  <span class="variable">self</span>.<span class="variable">orderLayers</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Empty the track
 </p>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">empty</span> = <span class="keyword">function</span>() {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  $(<span class="string">'#track'</span>+<span class="variable">self</span>.<span class="variable">metadata</span>.<span class="variable">id</span>).<span class="variable">empty</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clears the documents from the track canvas
 </p>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">clear</span> = <span class="keyword">function</span>() {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">documents</span>.<span class="variable">remove</span>();
  <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">setSize</span>(<span class="variable">self</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">height</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Refresh the documents in the track canvas.
This method first cleans the canvas then draws the new documents</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  data</p></li><li><p><strong>see</strong>: <em>Track</em>
.clear()</p></li><li><strong>see</strong>: <em>Track</em>
.draw()</li></ul>
</td>
<td class="code">
<pre><code><span class="class">Track</span>.<span class="variable">prototype</span>.<span class="variable">refresh</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">data</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">clear</span>();
  <span class="variable">self</span>.<span class="variable">data</span> = <span class="variable">data</span>;
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">start</span>, <span class="variable">end</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw a document</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  doc</p></li><li><p><strong>param</strong>: <em>Number</em>  view_start</p></li><li><p><strong>param</strong>: <em>Number</em>  view_end</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">drawDocument</span> = <span class="keyword">function</span>(<span class="variable">doc</span>, <span class="variable">view_start</span>, <span class="variable">view_end</span>, <span class="variable">layer</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">view_span</span> = <span class="variable">view_end</span> - <span class="variable">view_start</span>;
  <span class="keyword">var</span> <span class="variable">nf</span> = <span class="keyword">new</span> <span class="class">PHP_JS</span>().<span class="variable">number_format</span>;
  <span class="keyword">var</span> <span class="variable">rel_start</span> = (((<span class="class">Math</span>.<span class="variable">max</span>(<span class="variable">doc</span>.<span class="variable">start</span>, <span class="variable">view_start</span>) - <span class="variable">view_start</span>) / <span class="variable">view_span</span>) * (<span class="this">this</span>.<span class="variable">width</span>-<span class="number integer">100</span>)) + <span class="number integer">50</span>;
  <span class="keyword">var</span> <span class="variable">rel_end</span> = (((<span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">doc</span>.<span class="variable">end</span>, <span class="variable">view_end</span>) - <span class="variable">view_start</span>) / <span class="variable">view_span</span>) * (<span class="this">this</span>.<span class="variable">width</span>-<span class="number integer">100</span>)) + <span class="number integer">50</span>;
  <span class="keyword">var</span> <span class="variable">rel_doc_length</span> = <span class="variable">rel_end</span> - <span class="variable">rel_start</span>;
  <span class="keyword">var</span> <span class="variable">d</span> = <span class="this">this</span>.<span class="variable">rect</span>(<span class="variable">rel_start</span>, <span class="number integer">20</span>+<span class="number integer">20</span>*<span class="variable">layer</span>, <span class="variable">rel_doc_length</span>, <span class="number integer">10</span>).<span class="variable">attr</span>(<span class="variable">style</span>);
  <span class="keyword">var</span> <span class="variable">title</span> = [];
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="variable">doc</span>) {
    <span class="variable">title</span>.<span class="variable">push</span>(<span class="variable">i</span> + <span class="string">' : '</span> + <span class="variable">doc</span>[<span class="variable">i</span>]);
  }
  <span class="variable">d</span>.<span class="variable">attr</span>({ <span class="variable">title</span>: <span class="variable">title</span>.<span class="variable">join</span>(<span class="string">'\n'</span>) });
  <span class="keyword">return</span> <span class="variable">d</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./public/javascripts/client.js"><a href="#">client</a></h2></td><td>./public/javascripts/client.js</td></tr><tr class="code">
<td class="docs">
<p>Client side javascript</p>

<p>Renders all client-side data when page is ready.
 </p>
</td>
<td class="code">
<pre><code>$(<span class="variable">document</span>).<span class="variable">ready</span>(<span class="keyword">function</span>() {

  <span class="keyword">var</span> <span class="variable">navigation</span> = <span class="keyword">new</span> <span class="class">Navigation</span>();

  <span class="variable">tracks</span> = {};
  <span class="variable">previous</span> = {
    <span class="variable">tracks</span>: []
  , <span class="variable">pos</span>: <span class="number integer">0</span>
  , <span class="variable">seqid</span>: &<span class="variable">quot</span>;&<span class="variable">quot</span>;
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Setup dynamic prompt input text-fields.
The default value corresponds to the 'name' attribute
of the input field.
   </p>
</td>
<td class="code">
<pre><code>$(&<span class="variable">quot</span>;<span class="variable">input</span>[<span class="variable">type</span>=<span class="variable">text</span>]&<span class="variable">quot</span>;)
    .<span class="variable">focus</span>(<span class="keyword">function</span>(){
      <span class="variable">clearPrompt</span>(<span class="this">this</span>);
    })
    .<span class="variable">blur</span>(<span class="keyword">function</span>(){
      <span class="variable">setPrompt</span>(<span class="this">this</span>);
    });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Render tracks if parameters of the form are valid.</p>

<p>The text-field inputs for positions are also sanitized for
negative or too big values.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">validateForm</span>(<span class="keyword">function</span>(){
    <span class="keyword">var</span> <span class="variable">seqid</span> = $(<span class="string">'#seqid'</span>).<span class="variable">val</span>();
    <span class="keyword">var</span> <span class="variable">start</span> = <span class="variable">parseNum</span>($(<span class="string">'#start'</span>).<span class="variable">val</span>());
    <span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">parseNum</span>($(<span class="string">'#end'</span>).<span class="variable">val</span>());
    <span class="variable">fetchTracksData</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">true</span>);
    <span class="variable">navigation</span>.<span class="variable">display</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>);
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle browsing from main form.
   </p>
</td>
<td class="code">
<pre><code>$(<span class="string">'#submit'</span>).<span class="variable">click</span>(<span class="keyword">function</span>() {
    <span class="variable">validateForm</span>(<span class="keyword">function</span>(){
      <span class="keyword">var</span> <span class="variable">seqid</span> = $(<span class="string">'#seqid'</span>).<span class="variable">val</span>();
      <span class="keyword">var</span> <span class="variable">start</span> = <span class="variable">parseNum</span>($(<span class="string">'#start'</span>).<span class="variable">val</span>());
      <span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">parseNum</span>($(<span class="string">'#end'</span>).<span class="variable">val</span>());
      <span class="variable">fetchTracksData</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">true</span>);
      <span class="keyword">try</span> {
        <span class="variable">navigation</span>.<span class="variable">refresh</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>);
      } <span class="keyword">catch</span> (<span class="variable">err</span>) {
        <span class="keyword">if</span> (<span class="variable">err</span>.<span class="variable">arguments</span>[<span class="number integer">0</span>] === <span class="string">'remove'</span>) {
          <span class="variable">navigation</span>.<span class="variable">display</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>);
        }
      }
    });
    <span class="keyword">return</span> <span class="variable">false</span>;
  });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Makes the tracks divs sortable
   </p>
</td>
<td class="code">
<pre><code>$(&<span class="variable">quot</span>;#<span class="variable">tracks</span>&<span class="variable">quot</span>;).<span class="variable">sortable</span>({
    <span class="variable">placeholder</span>: <span class="string">'ui-state-highlight'</span>
  , <span class="variable">forcePlaceholderSize</span>: <span class="variable">true</span>
  , <span class="variable">opacity</span>: <span class="number float">0.8</span>
  , <span class="variable">cursor</span>: <span class="string">'move'</span>
  });
  $(<span class="string">'#tracks'</span>).<span class="variable">disableSelection</span>();</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle history navigation
   </p>
</td>
<td class="code">
<pre><code><span class="variable">window</span>.<span class="variable">onpopstate</span> = <span class="keyword">function</span>(<span class="variable">event</span>) {
    <span class="keyword">var</span> <span class="variable">state</span> = <span class="variable">event</span>.<span class="variable">state</span>;
    <span class="keyword">if</span> (<span class="variable">state</span>) {
      <span class="variable">fetchTracksData</span>(<span class="variable">state</span>.<span class="variable">seqid</span>, <span class="variable">state</span>.<span class="variable">start</span>, <span class="variable">state</span>.<span class="variable">end</span>, <span class="variable">false</span>);
      <span class="variable">navigation</span>.<span class="variable">refresh</span>(<span class="variable">state</span>.<span class="variable">seqid</span>, <span class="variable">state</span>.<span class="variable">start</span>, <span class="variable">state</span>.<span class="variable">end</span>);
    }
  };

});



<span class="comment">// **********   Form Navigation   ************</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Iteratively fetches data of all selected tracks.
After rendering, 'start' and 'end' values are updated</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">fetchTracksData</span> = <span class="keyword">function</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">updatehistory</span>) {
  <span class="keyword">var</span> <span class="variable">nf</span> = <span class="keyword">new</span> <span class="class">PHP_JS</span>().<span class="variable">number_format</span>;
  <span class="keyword">var</span> <span class="variable">trackselector</span> = $(<span class="string">'#trackselector :checked'</span>);
  <span class="keyword">var</span> <span class="variable">tracksIDs</span> = [];
  <span class="keyword">var</span> <span class="variable">trackID</span>;
  <span class="keyword">var</span> <span class="variable">reqURL</span> = <span class="string">'/'</span>+ <span class="variable">window</span>.<span class="variable">location</span>.<span class="variable">href</span>.<span class="variable">split</span>(<span class="string">'/'</span>).<span class="variable">slice</span>(<span class="number integer">3</span>, <span class="number integer">5</span>).<span class="variable">join</span>(<span class="string">'/'</span>);
  <span class="variable">trackselector</span>.<span class="variable">each</span>(<span class="keyword">function</span>(<span class="variable">i</span>) {
    <span class="variable">trackID</span> = $(<span class="variable">trackselector</span>[<span class="variable">i</span>]).<span class="variable">val</span>();
    <span class="variable">tracksIDs</span>.<span class="variable">push</span>(<span class="variable">trackID</span>);
  });
  <span class="variable">tracksIDs</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">trackid</span>) {
    <span class="keyword">if</span> (   <span class="variable">seqid</span> !== <span class="variable">previous</span>.<span class="variable">seqid</span>
        || <span class="variable">previous</span>.<span class="variable">tracks</span> === []
        || <span class="variable">previous</span>.<span class="variable">pos</span> === <span class="number integer">0</span>
        || <span class="variable">previous</span>.<span class="variable">tracks</span>.<span class="variable">indexOf</span>(<span class="variable">trackid</span>) === -<span class="number integer">1</span>
        || <span class="variable">previous</span>.<span class="variable">pos</span> !== (<span class="variable">start</span>+<span class="number integer">1</span>)*<span class="variable">end</span>) {
      <span class="variable">requestTrackData</span>(<span class="variable">reqURL</span>, <span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">trackid</span>, <span class="keyword">function</span>(<span class="variable">track</span>) {
        <span class="keyword">if</span> (!<span class="variable">tracks</span>[<span class="variable">trackid</span>]){
          <span class="variable">tracks</span>[<span class="variable">trackid</span>] = <span class="keyword">new</span> <span class="class">Track</span>(<span class="variable">track</span>, <span class="number integer">1101</span>, <span class="number integer">50</span>);
          <span class="variable">tracks</span>[<span class="variable">trackid</span>].<span class="variable">display</span>(<span class="variable">start</span>, <span class="variable">end</span>);
        } <span class="keyword">else</span> {
          <span class="variable">tracks</span>[<span class="variable">trackid</span>].<span class="variable">refresh</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">track</span>.<span class="variable">data</span>);
        }
      });
    }
  });
  <span class="variable">previous</span>.<span class="variable">tracks</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">ptrack</span>) {
    <span class="keyword">if</span> (<span class="variable">tracksIDs</span>.<span class="variable">indexOf</span>(<span class="variable">ptrack</span>) === -<span class="number integer">1</span>) {
      <span class="variable">tracks</span>[<span class="variable">ptrack</span>].<span class="variable">empty</span>();
      <span class="keyword">delete</span> <span class="variable">tracks</span>[<span class="variable">ptrack</span>];
    }
  });
  <span class="keyword">if</span> (<span class="variable">updatehistory</span>) {
    <span class="variable">window</span>.<span class="variable">history</span>.<span class="variable">pushState</span>({
      <span class="variable">seqid</span>: <span class="variable">seqid</span>
    , <span class="variable">start</span>: <span class="variable">start</span>
    , <span class="variable">end</span>: <span class="variable">end</span>
    , <span class="variable">tracksIDs</span>: <span class="variable">tracksIDs</span>
    }, <span class="string">''</span>,
      [<span class="variable">reqURL</span>, <span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">tracksIDs</span>.<span class="variable">join</span>(<span class="string">'&amp;'</span>)].<span class="variable">join</span>(<span class="string">'/'</span>)
    );
  }
  <span class="variable">previous</span>.<span class="variable">tracks</span> = <span class="variable">tracksIDs</span>;
  <span class="variable">previous</span>.<span class="variable">pos</span> = (<span class="variable">start</span>+<span class="number integer">1</span>)*<span class="variable">end</span>;
  <span class="variable">previous</span>.<span class="variable">seqid</span> = <span class="variable">seqid</span>;
  $(<span class="string">'#start'</span>).<span class="variable">val</span>(<span class="variable">nf</span>(<span class="variable">start</span>));
  $(<span class="string">'#end'</span>).<span class="variable">val</span>(<span class="variable">nf</span>(<span class="variable">end</span>));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Request data of a given track between 2 positions of a seqid.
The callback is triggered with the collected data</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  reqURL</p></li><li><p><strong>param</strong>: <em>string</em>  seqid</p></li><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>String</em>  trackID</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">requestTrackData</span> = <span class="keyword">function</span>(<span class="variable">reqURL</span>, <span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">trackID</span>, <span class="variable">callback</span>) {
  $.<span class="variable">ajax</span>({
    <span class="variable">type</span>: &<span class="variable">quot</span>;<span class="class">POST</span>&<span class="variable">quot</span>;
  , <span class="variable">url</span>: <span class="variable">reqURL</span>
  , <span class="variable">data</span>: {
      <span class="variable">seqid</span>: <span class="variable">seqid</span>
    , <span class="variable">start</span>: <span class="variable">start</span>
    , <span class="variable">end</span>: <span class="variable">end</span>
    , <span class="variable">trackID</span>: <span class="variable">trackID</span>
    }
  , <span class="variable">dataType</span>: &<span class="variable">quot</span>;<span class="variable">json</span>&<span class="variable">quot</span>;
  , <span class="variable">success</span>: <span class="keyword">function</span>(<span class="variable">data</span>) {
      <span class="variable">callback</span>(<span class="variable">data</span>);
    }
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get the metadata associated to the current seqid</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  seqid</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">getSeqidMetadata</span> = <span class="keyword">function</span>(<span class="variable">seqid</span>, <span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">dataset</span> = <span class="variable">window</span>.<span class="variable">location</span>.<span class="variable">href</span>.<span class="variable">split</span>(<span class="string">'/'</span>)[<span class="number integer">4</span>];
  <span class="keyword">if</span> (!<span class="variable">localStorage</span>[<span class="variable">dataset</span>+<span class="variable">seqid</span>+&<span class="variable">quot</span>;<span class="variable">metadata</span>&<span class="variable">quot</span>;]) {
    <span class="keyword">var</span> <span class="variable">reqURL</span> = <span class="string">'/'</span>
      + <span class="variable">window</span>.<span class="variable">location</span>.<span class="variable">href</span>.<span class="variable">split</span>(<span class="string">'/'</span>).<span class="variable">slice</span>(<span class="number integer">3</span>, <span class="number integer">5</span>).<span class="variable">join</span>(<span class="string">'/'</span>)
      + <span class="string">'/'</span> + <span class="variable">seqid</span> + &<span class="variable">quot</span>;.<span class="variable">json</span>&<span class="variable">quot</span>;;
    $.<span class="variable">ajax</span>({
      <span class="variable">type</span>: &<span class="variable">quot</span>;<span class="class">GET</span>&<span class="variable">quot</span>;
    , <span class="variable">url</span>: <span class="variable">reqURL</span>
    , <span class="variable">dataType</span>: &<span class="variable">quot</span>;<span class="variable">json</span>&<span class="variable">quot</span>;
    , <span class="variable">success</span>: <span class="keyword">function</span>(<span class="variable">metadata</span>) {
        <span class="keyword">if</span> (<span class="variable">metadata</span>){
          <span class="variable">localStorage</span>[<span class="variable">dataset</span>+<span class="variable">seqid</span>+&<span class="variable">quot</span>;<span class="variable">metadata</span>&<span class="variable">quot</span>;] = <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">metadata</span>);
          <span class="variable">callback</span>(<span class="variable">metadata</span>);
        }
      }
    });
  } <span class="keyword">else</span> {
    <span class="variable">callback</span>(<span class="class">JSON</span>.<span class="variable">parse</span>(<span class="variable">localStorage</span>[<span class="variable">dataset</span>+<span class="variable">seqid</span>+&<span class="variable">quot</span>;<span class="variable">metadata</span>&<span class="variable">quot</span>;]));
  }
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get the global style</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">getGlobalStyle</span> = <span class="keyword">function</span>(<span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">reqURL</span> = <span class="string">'/globalconfig.json'</span>;
  <span class="keyword">if</span> (!<span class="variable">localStorage</span>[&<span class="variable">quot</span>;<span class="variable">globalconfig</span>&<span class="variable">quot</span>;]) {
    $.<span class="variable">ajax</span>({
      <span class="variable">type</span>: &<span class="variable">quot</span>;<span class="class">GET</span>&<span class="variable">quot</span>;
    , <span class="variable">url</span>: <span class="variable">reqURL</span>
    , <span class="variable">dataType</span>: &<span class="variable">quot</span>;<span class="variable">json</span>&<span class="variable">quot</span>;
    , <span class="variable">success</span>: <span class="keyword">function</span>(<span class="variable">style</span>) {
        <span class="variable">localStorage</span>[&<span class="variable">quot</span>;<span class="variable">globalconfig</span>&<span class="variable">quot</span>;] = <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">style</span>);
        <span class="variable">callback</span>(<span class="variable">style</span>);
      }
    });
  } <span class="keyword">else</span> {
    <span class="variable">callback</span>(<span class="class">JSON</span>.<span class="variable">parse</span>(<span class="variable">localStorage</span>[&<span class="variable">quot</span>;<span class="variable">globalconfig</span>&<span class="variable">quot</span>;]));
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Validates the values in the form.
If the form is valid, the callback is triggered.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">validateForm</span> = <span class="keyword">function</span>(<span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">nf</span> = <span class="keyword">new</span> <span class="class">PHP_JS</span>().<span class="variable">number_format</span>;
  <span class="keyword">var</span> <span class="variable">seqid</span> = $(&<span class="variable">quot</span>;#<span class="variable">seqid</span>&<span class="variable">quot</span>;).<span class="variable">val</span>();
  <span class="keyword">var</span> <span class="variable">start</span> = <span class="variable">parseNum</span>($(&<span class="variable">quot</span>;#<span class="variable">start</span>&<span class="variable">quot</span>;).<span class="variable">val</span>());
  <span class="keyword">var</span> <span class="variable">end</span> = <span class="variable">parseNum</span>($(&<span class="variable">quot</span>;#<span class="variable">end</span>&<span class="variable">quot</span>;).<span class="variable">val</span>());
  <span class="keyword">var</span> <span class="variable">okSeqid</span> = <span class="variable">seqid</span> != <span class="string">'seqid'</span>;
  <span class="keyword">var</span> <span class="variable">okStart</span> = !<span class="variable">isNaN</span>(<span class="variable">start</span>);
  <span class="keyword">var</span> <span class="variable">okEnd</span> = !<span class="variable">isNaN</span>(<span class="variable">end</span>);
  <span class="keyword">var</span> <span class="variable">temp</span> = <span class="number integer">0</span>;
  <span class="keyword">if</span> (<span class="variable">start</span> &<span class="variable">gt</span>; <span class="variable">end</span>) {
    <span class="variable">temp</span> = <span class="variable">end</span>;
    <span class="variable">end</span> = <span class="variable">start</span>;
    <span class="variable">start</span> = <span class="variable">temp</span>;
  }
  <span class="keyword">if</span> (<span class="variable">okSeqid</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">okStart</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">okEnd</span>) {
    <span class="variable">sanitizeInputPos</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
      $(<span class="string">'#start'</span>).<span class="variable">val</span>(<span class="variable">nf</span>(<span class="variable">start</span>));
      $(<span class="string">'#end'</span>).<span class="variable">val</span>(<span class="variable">nf</span>(<span class="variable">end</span>));
      <span class="variable">callback</span>(<span class="variable">true</span>);
    });
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Reset positions to 0 or seqid.length if it exceeds those limits.
The call back is triggered with the new start and end positions.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">sanitizeInputPos</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">callback</span>) {
  <span class="variable">getSeqidMetadata</span>($(<span class="string">'#seqid'</span>).<span class="variable">val</span>(), <span class="keyword">function</span>(<span class="variable">seqidMD</span>) {
    <span class="variable">start</span> = <span class="class">Math</span>.<span class="variable">max</span>(<span class="number integer">0</span>, <span class="variable">start</span>)
    <span class="variable">end</span> = <span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">seqidMD</span>.<span class="variable">length</span>, <span class="variable">end</span>);
    <span class="variable">callback</span>(<span class="variable">start</span>, <span class="variable">end</span>);
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clear prompt from field</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  element</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">clearPrompt</span> = <span class="keyword">function</span>(<span class="variable">element</span>) {
  <span class="keyword">if</span> ($(<span class="variable">element</span>).<span class="variable">val</span>() == $(<span class="variable">element</span>).<span class="variable">attr</span>(<span class="string">'name'</span>)) {
    $(<span class="variable">element</span>).<span class="variable">val</span>(<span class="string">''</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set prompt for field</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  element</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">setPrompt</span> = <span class="keyword">function</span>(<span class="variable">element</span>) {
  <span class="keyword">if</span> ($(<span class="variable">element</span>).<span class="variable">val</span>() == <span class="string">''</span>) {
    $(<span class="variable">element</span>).<span class="variable">val</span>($(<span class="variable">element</span>).<span class="variable">attr</span>(<span class="string">'name'</span>));
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert a formated number to an integer.
Returns NaN if the formated number cannot be parsed.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str_num</p></li><li><p><strong>return</strong>: <em>Number</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">parseNum</span> = <span class="keyword">function</span>(<span class="variable">str_num</span>) {
  <span class="keyword">var</span> <span class="variable">nf</span> = <span class="keyword">new</span> <span class="class">PHP_JS</span>().<span class="variable">number_format</span>;
  <span class="variable">parsedNum</span> = <span class="variable">parseInt</span>(<span class="variable">nf</span>(<span class="variable">str_num</span>, <span class="number integer">0</span>, <span class="string">'.'</span>, <span class="string">''</span>), <span class="number integer">10</span>);
  <span class="keyword">if</span> (<span class="variable">parseInt</span>(<span class="variable">str_num</span>, <span class="number integer">10</span>) !== <span class="number integer">0</span>){
    <span class="keyword">if</span> (<span class="variable">parsedNum</span> !== <span class="number integer">0</span>){
      <span class="keyword">return</span> <span class="variable">parseInt</span>(<span class="variable">nf</span>(<span class="variable">str_num</span>, <span class="number integer">0</span>, <span class="string">'.'</span>, <span class="string">''</span>), <span class="number integer">10</span>);
    }
    <span class="keyword">return</span> <span class="keyword">NaN</span>;
  }
  <span class="keyword">return</span> <span class="number integer">0</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Function to handle a selected dataset in a dropdown menu</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  dropdown</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">OnSelect</span> = <span class="keyword">function</span>(<span class="variable">dropdown</span>) {
  <span class="keyword">var</span> <span class="variable">index</span> = <span class="variable">dropdown</span>.<span class="variable">selectedIndex</span>
    , <span class="variable">selected</span> = <span class="variable">dropdown</span>.<span class="variable">options</span>[<span class="variable">index</span>]
    , <span class="variable">baseURL</span> = <span class="string">'/browse/'</span> + <span class="variable">selected</span>.<span class="variable">value</span>;
  <span class="keyword">if</span> (<span class="variable">selected</span>.<span class="variable">value</span> != <span class="string">'Select a dataset'</span>) {
    <span class="variable">top</span>.<span class="variable">location</span>.<span class="variable">href</span> = <span class="variable">baseURL</span>;
    <span class="keyword">return</span> <span class="variable">true</span>;
  }
  <span class="keyword">return</span> <span class="variable">false</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./public/javascripts/navigation.js"><a href="#">navigation</a></h2></td><td>./public/javascripts/navigation.js</td></tr><tr class="code">
<td class="docs">
<p>Class emcapsulating navigation elements
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Navigation</span> = <span class="keyword">function</span>() {
  <span class="this">this</span>.<span class="variable">overviewNavigation</span> = <span class="keyword">new</span> <span class="class">OverviewNavigation</span>(<span class="this">this</span>, <span class="string">'overviewnavigation'</span>, <span class="number integer">1101</span>, <span class="number integer">50</span>);
  <span class="this">this</span>.<span class="variable">ratioZoom</span> = <span class="keyword">new</span> <span class="class">RatioZoom</span>(<span class="this">this</span>, <span class="string">'ratiozoom'</span>, <span class="number integer">1101</span>, <span class="number integer">50</span>);
  <span class="this">this</span>.<span class="variable">zoomNavigation</span> = <span class="keyword">new</span> <span class="class">ZoomNavigation</span>(<span class="this">this</span>, <span class="string">'zoomnavigation'</span>, <span class="number integer">1101</span>, <span class="number integer">50</span>);
  <span class="this">this</span>.<span class="variable">separator</span> = <span class="keyword">new</span> <span class="class">Separator</span>(<span class="this">this</span>,  <span class="string">'separator'</span>, <span class="number integer">1101</span>, <span class="number integer">15</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display all navigation elements</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  metadata</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Navigation</span>.<span class="variable">prototype</span>.<span class="variable">display</span> = <span class="keyword">function</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">getGlobalStyle</span>(<span class="keyword">function</span>(<span class="variable">style</span>) {
    <span class="variable">getSeqidMetadata</span>(<span class="variable">seqid</span>, <span class="keyword">function</span>(<span class="variable">meta</span>) {
      <span class="variable">self</span>.<span class="variable">overviewNavigation</span>.<span class="variable">display</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
      <span class="variable">self</span>.<span class="variable">ratioZoom</span>.<span class="variable">display</span>(<span class="variable">self</span>.<span class="variable">overviewNavigation</span>.<span class="variable">selected</span>, <span class="variable">style</span>);
      <span class="variable">self</span>.<span class="variable">zoomNavigation</span>.<span class="variable">display</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
      <span class="variable">self</span>.<span class="variable">separator</span>.<span class="variable">display</span>(<span class="variable">style</span>);
    });
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Refresh all navigation elements</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  metadata</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Navigation</span>.<span class="variable">prototype</span>.<span class="variable">refresh</span> = <span class="keyword">function</span>(<span class="variable">seqid</span>, <span class="variable">start</span>, <span class="variable">end</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">getGlobalStyle</span>(<span class="keyword">function</span>(<span class="variable">style</span>) {
    <span class="variable">getSeqidMetadata</span>(<span class="variable">seqid</span>, <span class="keyword">function</span>(<span class="variable">meta</span>) {
      <span class="variable">self</span>.<span class="variable">overviewNavigation</span>.<span class="variable">refresh</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
      <span class="variable">self</span>.<span class="variable">ratioZoom</span>.<span class="variable">refresh</span>(<span class="variable">self</span>.<span class="variable">overviewNavigation</span>.<span class="variable">selected</span>, <span class="variable">style</span>);
      <span class="variable">self</span>.<span class="variable">zoomNavigation</span>.<span class="variable">refresh</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
    });
  });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Overview of the seqid
The containing navigation must be specified in order to bind events.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  container</p></li><li><p><strong>param</strong>: <em>String</em>  anchor</p></li><li><p><strong>param</strong>: <em>Number</em>  width</p></li><li><p><strong>param</strong>: <em>Number</em>  height</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">OverviewNavigation</span> = <span class="keyword">function</span>(<span class="variable">container</span>, <span class="variable">anchor</span>, <span class="variable">width</span>, <span class="variable">height</span>) {
  <span class="this">this</span>.<span class="variable">container</span> = <span class="variable">container</span>;
  <span class="this">this</span>.<span class="variable">anchor</span> = <span class="variable">anchor</span>;
  <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">width</span>;
  <span class="this">this</span>.<span class="variable">height</span> = <span class="variable">height</span>;
  <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">bgrules</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">ruler</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">selected</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">selectableArea</span> = <span class="variable">undefined</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display the overview of the seqid.
This method instanciates the canvas and draws in it.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  metadata</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>see</strong>: <em>OverviewNavigation</em>
.draw()</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">OverviewNavigation</span>.<span class="variable">prototype</span>.<span class="variable">display</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">canvas</span> = <span class="class">Raphael</span>(<span class="variable">self</span>.<span class="variable">anchor</span>, <span class="variable">self</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">height</span>);
  <span class="variable">self</span>.<span class="variable">bgrules</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawBgRules</span>(<span class="number integer">10</span>, <span class="variable">style</span>.<span class="variable">bgrules</span>);
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the overview of the seqid.
This method draws in the canvas previously instanciated.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  metadata</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">OverviewNavigation</span>.<span class="variable">prototype</span>.<span class="variable">draw</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">ruler</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawMainRuler</span>(<span class="number integer">0</span>, <span class="variable">meta</span>.<span class="variable">length</span>, <span class="variable">style</span>.<span class="variable">ruler</span>);
  <span class="variable">self</span>.<span class="variable">selected</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">currentSpan</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>.<span class="variable">length</span>, <span class="variable">style</span>.<span class="variable">selectedspan</span>);
  <span class="variable">self</span>.<span class="variable">selectableArea</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">explorableArea</span>(<span class="number integer">0</span>, <span class="variable">meta</span>.<span class="variable">length</span>, <span class="variable">style</span>.<span class="variable">selectionspan</span>, <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
    <span class="variable">fetchTracksData</span>(<span class="variable">meta</span>.<span class="variable">_id</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">true</span>);
    <span class="variable">self</span>.<span class="variable">container</span>.<span class="variable">refresh</span>(<span class="variable">meta</span>.<span class="variable">_id</span>, <span class="variable">start</span>, <span class="variable">end</span>);
  });
  <span class="variable">self</span>.<span class="variable">selectableArea</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">selected</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">ruler</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">bgrules</span>.<span class="variable">toBack</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clear the element.
This only removes the potentially modified elements,
that is the ruler and the selected area.
 </p>
</td>
<td class="code">
<pre><code><span class="class">OverviewNavigation</span>.<span class="variable">prototype</span>.<span class="variable">clear</span> = <span class="keyword">function</span>() {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">ruler</span>.<span class="variable">remove</span>();
  <span class="variable">self</span>.<span class="variable">selectableArea</span>.<span class="variable">remove</span>();
  <span class="variable">self</span>.<span class="variable">selected</span>.<span class="variable">remove</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Refresh the view.
This calls the clear() and draw() methods back-to-back</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  metadata</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>see</strong>: <em>OverviewNavigation</em>
.clear()</p></li><li><strong>see</strong>: <em>OverviewNavigation</em>
.draw()</li></ul>
</td>
<td class="code">
<pre><code><span class="class">OverviewNavigation</span>.<span class="variable">prototype</span>.<span class="variable">refresh</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>){
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">clear</span>();
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Zoomed view of the seqid
The containing navigation must be specified in order to bind events.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  container</p></li><li><p><strong>param</strong>: <em>String</em>  anchor</p></li><li><p><strong>param</strong>: <em>Number</em>  width</p></li><li><p><strong>param</strong>: <em>Number</em>  height</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">ZoomNavigation</span> = <span class="keyword">function</span>(<span class="variable">container</span>, <span class="variable">anchor</span>, <span class="variable">width</span>, <span class="variable">height</span>) {
  <span class="this">this</span>.<span class="variable">container</span> = <span class="variable">container</span>;
  <span class="this">this</span>.<span class="variable">anchor</span> = <span class="variable">anchor</span>;
  <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">width</span>;
  <span class="this">this</span>.<span class="variable">height</span> = <span class="variable">height</span>;
  <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">bgrules</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">ruler</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">selectableArea</span> = <span class="variable">undefined</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display the zoomed view of the seqid.
This method instanciates the canvas and draws in it.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>see</strong>: <em>ZoomNavigation</em>
.draw()</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">ZoomNavigation</span>.<span class="variable">prototype</span>.<span class="variable">display</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">canvas</span> = <span class="class">Raphael</span>(<span class="variable">self</span>.<span class="variable">anchor</span>, <span class="variable">self</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">height</span>);
  <span class="variable">self</span>.<span class="variable">bgrules</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawBgRules</span>(<span class="number integer">10</span>, <span class="variable">style</span>.<span class="variable">bgrules</span>);
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the zoomed view of the seqid.
This method draws in the canvas previously instanciated.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">ZoomNavigation</span>.<span class="variable">prototype</span>.<span class="variable">draw</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">ruler</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawMainRuler</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">style</span>.<span class="variable">ruler</span>);
  <span class="variable">self</span>.<span class="variable">selectableArea</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">explorableArea</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">style</span>.<span class="variable">selectionspan</span>, <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
    <span class="variable">fetchTracksData</span>(<span class="variable">meta</span>.<span class="variable">_id</span>, <span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">true</span>);
    <span class="variable">self</span>.<span class="variable">container</span>.<span class="variable">refresh</span>(<span class="variable">meta</span>.<span class="variable">_id</span>, <span class="variable">start</span>, <span class="variable">end</span>);
  });
  <span class="variable">self</span>.<span class="variable">selectableArea</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">ruler</span>.<span class="variable">toBack</span>();
  <span class="variable">self</span>.<span class="variable">bgrules</span>.<span class="variable">toBack</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clear the element.
This only removes the potentially modified elements,
that is the ruler and the selectable area.
 </p>
</td>
<td class="code">
<pre><code><span class="class">ZoomNavigation</span>.<span class="variable">prototype</span>.<span class="variable">clear</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">ruler</span>.<span class="variable">remove</span>();
  <span class="variable">self</span>.<span class="variable">selectableArea</span>.<span class="variable">remove</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Refresh the view.
This calls the clear() and draw() methods back-to-back</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  start</p></li><li><p><strong>param</strong>: <em>Number</em>  end</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>see</strong>: <em>ZoomNavigation</em>
.clear()</p></li><li><strong>see</strong>: <em>ZoomNavigation</em>
.draw()</li></ul>
</td>
<td class="code">
<pre><code><span class="class">ZoomNavigation</span>.<span class="variable">prototype</span>.<span class="variable">refresh</span> = <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">clear</span>();
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">start</span>, <span class="variable">end</span>, <span class="variable">meta</span>, <span class="variable">style</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Ratio effect between the overview and the zoomed view
The containing navigation must be specified in order to bind events.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  container</p></li><li><p><strong>param</strong>: <em>String</em>  anchor</p></li><li><p><strong>param</strong>: <em>Number</em>  width</p></li><li><p><strong>param</strong>: <em>Number</em>  height</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">RatioZoom</span> = <span class="keyword">function</span>(<span class="variable">container</span>, <span class="variable">anchor</span>, <span class="variable">width</span>, <span class="variable">height</span>) {
  <span class="this">this</span>.<span class="variable">container</span> = <span class="variable">container</span>;
  <span class="this">this</span>.<span class="variable">anchor</span> = <span class="variable">anchor</span>;
  <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">width</span>;
  <span class="this">this</span>.<span class="variable">height</span> = <span class="variable">height</span>;
  <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">bgrules</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">ratio</span> = <span class="variable">undefined</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display the ratio.
This method instanciates the canvas and draws in it.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  current_span</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>see</strong>: <em>RatioZoom</em>
.draw()</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">RatioZoom</span>.<span class="variable">prototype</span>.<span class="variable">display</span> = <span class="keyword">function</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">canvas</span> = <span class="class">Raphael</span>(<span class="variable">self</span>.<span class="variable">anchor</span>, <span class="variable">self</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">height</span>);
  <span class="variable">self</span>.<span class="variable">ratio</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">set</span>();
  <span class="variable">self</span>.<span class="variable">bgrules</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawBgRules</span>(<span class="number integer">10</span>, <span class="variable">style</span>.<span class="variable">bgrules</span>);
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the ratio.
This method draws in the canvas previously instanciated.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  current_span</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">RatioZoom</span>.<span class="variable">prototype</span>.<span class="variable">draw</span> = <span class="keyword">function</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">ratio</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawRatio</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>);
  <span class="variable">self</span>.<span class="variable">bgrules</span>.<span class="variable">toBack</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clear the element.
This only removes the potentially modified elements,
that is the ratio lines.
 </p>
</td>
<td class="code">
<pre><code><span class="class">RatioZoom</span>.<span class="variable">prototype</span>.<span class="variable">clear</span> = <span class="keyword">function</span>() {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">ratio</span>.<span class="variable">remove</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Refresh the view.
This calls the clear() and draw() methods back-to-back</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  current_span</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>see</strong>: <em>RatioZoom</em>
.clear()</p></li><li><strong>see</strong>: <em>RatioZoom</em>
.draw()</li></ul>
</td>
<td class="code">
<pre><code><span class="class">RatioZoom</span>.<span class="variable">prototype</span>.<span class="variable">refresh</span> = <span class="keyword">function</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">clear</span>();
  <span class="variable">self</span>.<span class="variable">draw</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>);
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Separator</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  container</p></li><li><p><strong>param</strong>: <em>String</em>  anchor</p></li><li><p><strong>param</strong>: <em>Number</em>  width</p></li><li><p><strong>param</strong>: <em>Number</em>  height</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Separator</span> = <span class="keyword">function</span>(<span class="variable">container</span>, <span class="variable">anchor</span>, <span class="variable">width</span>, <span class="variable">height</span>) {
  <span class="this">this</span>.<span class="variable">container</span> = <span class="variable">container</span>;
  <span class="this">this</span>.<span class="variable">anchor</span> = <span class="variable">anchor</span>;
  <span class="this">this</span>.<span class="variable">width</span> = <span class="variable">width</span>;
  <span class="this">this</span>.<span class="variable">height</span> = <span class="variable">height</span>;
  <span class="this">this</span>.<span class="variable">canvas</span> = <span class="variable">undefined</span>;
  <span class="this">this</span>.<span class="variable">bgrules</span> = <span class="variable">undefined</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display the separator.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Separator</span>.<span class="variable">prototype</span>.<span class="variable">display</span> = <span class="keyword">function</span>(<span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="variable">self</span>.<span class="variable">canvas</span> = <span class="class">Raphael</span>(<span class="variable">self</span>.<span class="variable">anchor</span>, <span class="variable">self</span>.<span class="variable">width</span>, <span class="variable">self</span>.<span class="variable">height</span>);
  <span class="variable">self</span>.<span class="variable">bgrules</span> = <span class="variable">self</span>.<span class="variable">canvas</span>.<span class="variable">drawBgRules</span>(<span class="number integer">10</span>, <span class="variable">style</span>.<span class="variable">bgrules</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the labeled ruler</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  view_start</p></li><li><p><strong>param</strong>: <em>Number</em>  view_end</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">drawMainRuler</span> = <span class="keyword">function</span>(<span class="variable">view_start</span>, <span class="variable">view_end</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">nf</span> = <span class="keyword">new</span> <span class="class">PHP_JS</span>().<span class="variable">number_format</span>
  <span class="keyword">var</span> <span class="variable">view_span</span> = <span class="variable">view_end</span> - <span class="variable">view_start</span>;
  <span class="keyword">var</span> <span class="variable">view_step</span> = <span class="variable">view_span</span> / <span class="number integer">5</span>;
  <span class="keyword">var</span> <span class="variable">ruler</span> = <span class="this">this</span>.<span class="variable">set</span>();
  <span class="variable">ruler</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">lineTo</span>(<span class="number integer">50</span>, <span class="number integer">2</span>*<span class="this">this</span>.<span class="regexp">/3, this.width-50, 2*this.height/</span><span class="number integer">3</span>).<span class="variable">attr</span>(<span class="variable">style</span>));
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">x</span> = <span class="number float">50.5</span>; <span class="variable">x</span> &<span class="variable">lt</span>;= <span class="this">this</span>.<span class="variable">width</span>-<span class="number integer">50</span>; <span class="variable">x</span> += <span class="number integer">40</span>) {
    <span class="variable">ruler</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>, <span class="number integer">2</span>*<span class="this">this</span>.<span class="regexp">/3-3, x, 2*this.height/</span><span class="number integer">3</span>+<span class="number integer">3</span>).<span class="variable">attr</span>(<span class="variable">style</span>));
  }
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">x</span> = <span class="number integer">50</span>; <span class="variable">x</span> &<span class="variable">lt</span>;= <span class="this">this</span>.<span class="variable">width</span>-<span class="number integer">50</span>; <span class="variable">x</span> += <span class="number integer">200</span>) {
    <span class="variable">ruler</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">text</span>(<span class="variable">x</span>, <span class="number integer">12</span>, <span class="variable">nf</span>(<span class="variable">view_start</span>+<span class="variable">view_step</span>*((<span class="variable">x</span>-<span class="number integer">50</span>)/<span class="number integer">200</span>))));
    <span class="variable">ruler</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>+<span class="number float">0.5</span>, <span class="number integer">2</span>*<span class="this">this</span>.<span class="regexp">/3-8, x+0.5, 2*this.height/</span><span class="number integer">3</span>+<span class="number integer">8</span>).<span class="variable">attr</span>(<span class="variable">style</span>));
  }
  <span class="keyword">return</span> <span class="variable">ruler</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display 2 lines going from the current selection in the overview to the local view</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  cur_span</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">drawRatio</span> = <span class="keyword">function</span>(<span class="variable">cur_span</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">sx1</span> = <span class="variable">cur_span</span>.<span class="variable">attrs</span>.<span class="variable">x</span>;
  <span class="keyword">var</span> <span class="variable">sy1</span> = <span class="number integer">0</span>;
  <span class="keyword">var</span> <span class="variable">sx2</span> = <span class="number integer">50</span>;
  <span class="keyword">var</span> <span class="variable">sy2</span> = <span class="this">this</span>.<span class="variable">height</span>;
  <span class="keyword">var</span> <span class="variable">ex1</span> = <span class="variable">cur_span</span>.<span class="variable">attrs</span>.<span class="variable">x</span> + <span class="variable">cur_span</span>.<span class="variable">attrs</span>.<span class="variable">width</span>;
  <span class="keyword">var</span> <span class="variable">ey1</span> = <span class="number integer">0</span>;
  <span class="keyword">var</span> <span class="variable">ex2</span> = <span class="this">this</span>.<span class="variable">width</span> - <span class="number integer">50</span>;
  <span class="keyword">var</span> <span class="variable">ey2</span> = <span class="this">this</span>.<span class="variable">height</span>;
  <span class="keyword">var</span> <span class="variable">ratio</span> = <span class="this">this</span>.<span class="variable">set</span>();
  <span class="variable">ratio</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">lineTo</span>(<span class="variable">sx1</span>, <span class="variable">sy1</span>, <span class="variable">sx2</span>, <span class="variable">sy2</span>).<span class="variable">attr</span>(<span class="variable">style</span>));
  <span class="variable">ratio</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">lineTo</span>(<span class="variable">ex1</span>, <span class="variable">ey1</span>, <span class="variable">ex2</span>, <span class="variable">ey2</span>).<span class="variable">attr</span>(<span class="variable">style</span>));
  <span class="keyword">return</span> <span class="variable">ratio</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Display the area currently selected</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  view_start</p></li><li><p><strong>param</strong>: <em>Number</em>  view_end</p></li><li><p><strong>param</strong>: <em>Number</em>  tot_length</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li><li><p><strong>return</strong>: <em>SVG</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">currentSpan</span> = <span class="keyword">function</span>(<span class="variable">view_start</span>, <span class="variable">view_end</span>, <span class="variable">tot_length</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">view_span</span> = <span class="variable">view_end</span> - <span class="variable">view_start</span>;
  <span class="keyword">var</span> <span class="variable">rel_start</span> = (((<span class="variable">view_start</span>) / <span class="variable">tot_length</span>) * (<span class="this">this</span>.<span class="variable">width</span>-<span class="number integer">100</span>)) + <span class="number integer">50</span>;
  <span class="keyword">var</span> <span class="variable">rel_end</span> = (((<span class="variable">view_end</span>) / <span class="variable">tot_length</span>) * (<span class="this">this</span>.<span class="variable">width</span>-<span class="number integer">100</span>)) + <span class="number integer">50</span>;
  <span class="keyword">var</span> <span class="variable">rel_doc_length</span> = <span class="variable">rel_end</span> - <span class="variable">rel_start</span>;
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">rect</span>(<span class="variable">rel_start</span>, <span class="number integer">1</span>, <span class="variable">rel_doc_length</span>, <span class="this">this</span>.<span class="variable">height</span>-<span class="number integer">2</span>).<span class="variable">attr</span>(<span class="variable">style</span>);
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Add a selectable area to a Paper.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  view_start</p></li><li><p><strong>param</strong>: <em>Number</em>  view_end</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">explorableArea</span> = <span class="keyword">function</span>(<span class="variable">view_start</span>, <span class="variable">view_end</span>, <span class="variable">style</span>, <span class="variable">callback</span>) {
  <span class="keyword">var</span> <span class="variable">gs</span>, <span class="variable">ge</span>;
  <span class="keyword">var</span> <span class="variable">view_span</span> = <span class="variable">view_end</span> - <span class="variable">view_start</span>;
  <span class="keyword">var</span> <span class="variable">a</span> = <span class="this">this</span>.<span class="variable">rect</span>(<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="this">this</span>.<span class="variable">width</span>, <span class="this">this</span>.<span class="variable">height</span>).<span class="variable">attr</span>({
        <span class="string">'fill-opacity'</span>: <span class="number integer">0</span>,
        <span class="string">'stroke-opacity'</span>: <span class="number integer">0</span>,
        <span class="variable">fill</span>: <span class="string">'#eee'</span>
      });
  <span class="variable">a</span>.<span class="variable">drag</span>(
    <span class="comment">// Mouse move</span>
    <span class="keyword">function</span>(<span class="variable">dx</span>, <span class="variable">dy</span>, <span class="variable">x</span>, <span class="variable">y</span>, <span class="variable">e</span>) {
      <span class="keyword">if</span> (<span class="variable">dx</span> &<span class="variable">gt</span>; <span class="number integer">0</span>) { 
        <span class="this">this</span>.<span class="variable">selector</span>.<span class="variable">attr</span>({
          <span class="variable">x</span>: <span class="this">this</span>.<span class="variable">selector</span>.<span class="variable">ox</span>
        , <span class="variable">width</span>: <span class="variable">dx</span>-<span class="number integer">1</span>
        });
      } <span class="keyword">else</span> {
        <span class="this">this</span>.<span class="variable">selector</span>.<span class="variable">attr</span>({
          <span class="variable">x</span>: <span class="variable">e</span>.<span class="variable">offsetX</span>+<span class="number integer">1</span>
        , <span class="variable">width</span>: -<span class="variable">dx</span>
        });
      }
    },
    <span class="comment">// Mouse down</span>
    <span class="keyword">function</span>(<span class="variable">x</span>, <span class="variable">y</span>, <span class="variable">e</span>) {
      <span class="keyword">if</span> (!<span class="variable">e</span>.<span class="variable">offsetX</span>) {
        <span class="variable">e</span>.<span class="variable">offsetX</span> = <span class="variable">e</span>.<span class="variable">clientX</span> - $(<span class="variable">e</span>.<span class="variable">target</span>).<span class="variable">position</span>().<span class="variable">left</span>;
      }
      <span class="variable">gs</span> = <span class="class">Math</span>.<span class="variable">floor</span>((((<span class="variable">e</span>.<span class="variable">offsetX</span>-<span class="number integer">50</span>)/(<span class="this">this</span>.<span class="variable">paper</span>.<span class="variable">width</span>-<span class="number integer">100</span>)) * <span class="variable">view_span</span>) + <span class="variable">view_start</span>);
      <span class="this">this</span>.<span class="variable">selector</span> = <span class="this">this</span>.<span class="variable">paper</span>.<span class="variable">rect</span>(<span class="variable">e</span>.<span class="variable">offsetX</span>, <span class="number integer">1</span>, <span class="number integer">1</span>, <span class="this">this</span>.<span class="variable">attr</span>(<span class="string">'height'</span>)-<span class="number integer">2</span>).<span class="variable">attr</span>(<span class="variable">style</span>); 
      <span class="this">this</span>.<span class="variable">selector</span>.<span class="variable">ox</span> = <span class="this">this</span>.<span class="variable">selector</span>.<span class="variable">attr</span>(<span class="string">'x'</span>);
    },
    <span class="comment">// Mouse up</span>
    <span class="keyword">function</span>(<span class="variable">e</span>) {
      <span class="keyword">var</span> <span class="variable">goto_start</span>
        , <span class="variable">goto_end</span>;
      <span class="keyword">if</span> (!<span class="variable">e</span>.<span class="variable">offsetX</span>) {
        <span class="variable">e</span>.<span class="variable">offsetX</span> = <span class="variable">e</span>.<span class="variable">clientX</span> - $(<span class="variable">e</span>.<span class="variable">target</span>).<span class="variable">position</span>().<span class="variable">left</span>;
      }
      <span class="variable">ge</span> = <span class="class">Math</span>.<span class="variable">floor</span>((((<span class="variable">e</span>.<span class="variable">offsetX</span>-<span class="number integer">50</span>)/(<span class="this">this</span>.<span class="variable">paper</span>.<span class="variable">width</span>-<span class="number integer">100</span>)) * <span class="variable">view_span</span>) + <span class="variable">view_start</span>);
      <span class="variable">goto_start</span> = <span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">gs</span>, <span class="variable">ge</span>);
      <span class="variable">goto_end</span> = <span class="class">Math</span>.<span class="variable">max</span>(<span class="variable">gs</span>, <span class="variable">ge</span>);
      <span class="this">this</span>.<span class="variable">selector</span>.<span class="variable">remove</span>();
      <span class="comment">// Span selection</span>
      <span class="keyword">if</span> (<span class="variable">goto_start</span> != <span class="variable">goto_end</span>) {
        <span class="variable">sanitizeInputPos</span>(<span class="variable">goto_start</span>, <span class="variable">goto_end</span>, <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
          <span class="variable">callback</span>(<span class="variable">start</span>, <span class="variable">end</span>);
        });
      }
      <span class="comment">// Location click</span>
      <span class="keyword">else</span> {
        <span class="keyword">var</span> <span class="variable">i_span</span> = <span class="class">Math</span>.<span class="variable">floor</span>((<span class="variable">parseNum</span>($(<span class="string">'#end'</span>).<span class="variable">val</span>()) - <span class="variable">parseNum</span>($(<span class="string">'#start'</span>).<span class="variable">val</span>())) / <span class="number integer">2</span>);
        <span class="variable">sanitizeInputPos</span>(<span class="variable">goto_start</span>-<span class="variable">i_span</span>, <span class="variable">goto_end</span>+<span class="variable">i_span</span>, <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>) {
          <span class="variable">callback</span>(<span class="variable">start</span>, <span class="variable">end</span>);
        });
      }
    }
  );
  <span class="keyword">return</span> <span class="variable">a</span>;
}
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="./public/javascripts/rulersUI.js"><a href="#">rulersUI</a></h2></td><td>./public/javascripts/rulersUI.js</td></tr><tr class="code">
<td class="docs">
<p>Draw a line from (x1;y1) to (x2;y2)</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  x1</p></li><li><p><strong>param</strong>: <em>Number</em>  y1</p></li><li><p><strong>param</strong>: <em>Number</em>  x2</p></li><li><p><strong>param</strong>: <em>Number</em>  y2</p></li><li><p><strong>return</strong>: <em>SVG</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">lineTo</span> = <span class="keyword">function</span>(<span class="variable">x1</span>, <span class="variable">y1</span>, <span class="variable">x2</span>, <span class="variable">y2</span>) {
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">path</span>(&<span class="variable">quot</span>;<span class="class">M</span>&<span class="variable">quot</span>; + <span class="variable">x1</span> + &<span class="variable">quot</span>; &<span class="variable">quot</span>; + <span class="variable">y1</span> + &<span class="variable">quot</span>;<span class="class">L</span>&<span class="variable">quot</span>; + <span class="variable">x2</span> + &<span class="variable">quot</span>; &<span class="variable">quot</span>; + <span class="variable">y2</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Draw the background rules</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  step</p></li><li><p><strong>param</strong>: <em>Object</em>  style</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Raphael</span>.<span class="variable">fn</span>.<span class="variable">drawBgRules</span> = <span class="keyword">function</span>(<span class="variable">step</span>, <span class="variable">style</span>) {
  <span class="keyword">var</span> <span class="variable">rules</span> = <span class="this">this</span>.<span class="variable">set</span>();
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">x</span> = <span class="number float">0.5</span>; <span class="variable">x</span> &<span class="variable">lt</span>;= <span class="this">this</span>.<span class="variable">width</span>; <span class="variable">x</span> += <span class="variable">step</span>){
    <span class="variable">rules</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">lineTo</span>(<span class="variable">x</span>, <span class="number integer">0</span>, <span class="variable">x</span>, <span class="this">this</span>.<span class="variable">height</span>).<span class="variable">attr</span>(<span class="variable">style</span>).<span class="variable">toBack</span>());
  }
  <span class="keyword">return</span> <span class="variable">rules</span>;
};
</code></pre>
</td>
</tr>	</body>
</html></tbody></table>